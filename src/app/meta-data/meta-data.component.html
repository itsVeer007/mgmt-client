<div class="container-fluid users" id="top">
  <!-- header -->
  <div class="d-flex justify-content-between align-items-center">
    <div class="users-header">
      <!-- <p *ngIf="typeInput.value == 'Create_New'">List of Metadata - <span>{{ newMetaData.length }}</span></p> -->
      <p>List of Metadata - <span>{{ metaData.length }}</span></p>
    </div>

    <div>
      <!-- <a class="pointer" (click)="show('ticket')">
        <img src="assets/icons/add.svg" alt="">
      </a> -->
      <button mat-flat-button color="primary" (click)="show('ticket', typeInput.value)" [disabled]="typeInput.value == 'All'">Create Metadata</button>
    </div>
  </div>
  <!-- /header -->

  <!-- form -->
  <div class="search-form">
    <div class="row col-lg-10 col-md-10">
      <div class="col-lg-3 col-md-3 col-sm-12">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Select Type</mat-label>
          <input matInput [matAutocomplete]="dev" #typeInput (keyup)="searchDevices($event)" [(ngModel)]="metaType">
          <button matSuffix mat-icon-button>
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
          <mat-autocomplete #dev="matAutocomplete">
            <mat-option value="Create_New">Create new</mat-option>
            <mat-option value="All">All</mat-option>
            <mat-option *ngFor="let item of typeToTable | search: deviceSearch" [value]="item" (click)="filterDevices(item)">
              {{ item }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>

      <div class="col-lg-3 col-md-3 col-sm-12">
        <mat-form-field class="example-form-field" appearance="outline" class="w-100">
          <mat-label>Search</mat-label>
          <input matInput type="text"  [(ngModel)]="searchText">
          <button matSuffix mat-icon-button>
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>

    <div class="col-lg-2 col-md-2 col-sm-12 text-end">
      <!-- <div class="lists" *ngIf="showIconView" style="margin-right: 60px; margin-top: -40px;">View</div> -->
      <!-- <div class="lists" *ngIf="showIconEdit" style="margin-right: 30px; margin-top: -40px;">Edit</div>
      <div class="lists" *ngIf="showIconDelete" style="margin-right: -5px; margin-top: -40px;">Delete</div> -->

      <!-- <a class="mx-2 pointer" (click)="viewBySelectedOne()"><img src="assets/icons/view.svg" (mouseenter)="showIconView = true" (mouseleave)="showIconView = false" /></a> -->
      <a class="mx-2 pointer" (click)="editBySelectedOne()"><img src="assets/icons/edit.svg" (mouseenter)="showIconEdit = true" (mouseleave)="showIconEdit = false" /></a>
      <a class="mx-2 pointer" (click)="deleteSelected()"><img src="assets/icons/delete.svg" (mouseenter)="showIconDelete = true" (mouseleave)="showIconDelete = false" /></a>
    </div>
  </div>
  <!-- /form -->

  <!-- table starts -->
  <div class="table-resp">
    <table class="table table-hover" id="mytable">
      <thead>
        <tr class="form1">
          <th>
              <input type="checkbox" class="form-check-input" [(ngModel)]="selectedAll" (change)="selectAll()"
                id="allcheck" style="
                  background-color: #00000000;
                  border-color: #fff;
                  margin-left: 10px;
                " />
            </th>

            <th>
              <span>KeyId</span>
              <img (click)="sort('keyId')" class="pointer ms-1" src="assets/icons/sorticon.svg" width="15px">
            </th>

            <th>
              <span>Type</span>
              <img (click)="sort('type')" class="pointer ms-1" src="assets/icons/sorticon.svg" width="15px">
            </th>

            <th>
              <span>Value</span>
              <img (click)="sort('value')" class="pointer ms-1" src="assets/icons/sorticon.svg" width="15px">
            </th>

            <th>
              <span>Status</span>
              <img (click)="sort('active')" class="pointer ms-1" src="assets/icons/sorticon.svg" width="15px">
            </th>

            <th>Remarks</th>

            <th></th>
        </tr>
      </thead>

      <tbody *ngIf="typeInput.value == 'All'">
        <ng-container *ngFor="let obj of metaData | search: searchText; let i = index">
          <ng-container *ngFor="let item of obj.metadata">
            <tr>
              <td>
                <input type="checkbox" name="foo" class="form-check-input" [(ngModel)]="item.selected" (change)="
                    checkIfAllSelected();
                    deleteMultiRecords(item, i, $event);
                    ViewByCheckbox(item, i, $event);
                    EditByCheckbox(item, i, $event)
                  " id="singleCheck" />
              </td>

              <!-- <td>
                <p>--</p>
              </td> -->

              <td>
                <p>{{item.keyId}}</p>
              </td>

              <td>
                <p>{{obj.type}}</p>
              </td>

              <td>
                <p>{{item.value}}</p>
              </td>

              <td>
                <p [style.color]="item.active == 'Y' ? '#00A44C' : item.active == 'N' ? '#fa500f' : ''">
                  {{item.active == 'Y' ? 'Active' : item.active == 'N' ? 'Inactive' : '--'}}
                </p>
              </td>

              <td>
                <p>{{item.remarks ? item.remarks : '--'}}</p>
              </td>

              <td style="position: relative;">
                <a class="pointer" (click)="closeDot($event, i)"><img src="assets/icons/dotlist.svg" width="30" height="12" /></a>
                <div class="plus-img1" id="plus-img{{ i }}" style="display: none">
                  <!-- <div class="lists" *ngIf="showIconView1" style="margin-left: 5px; margin-top: -20px">
                    View
                  </div> -->
                  <div class="lists" *ngIf="showIconEdit1" style="margin-left: 8px; margin-top: -25px">
                    Edit
                  </div>
                  <div class="lists" *ngIf="showIconDelete1" style="margin-left: 28px; margin-top: -25px">
                    Delete
                  </div>

                  <!-- <a class="mx-2" (click)="openViewPopup(item, i)"><img src="assets/icons/view.svg"
                      (mouseenter)="showIconView1 = true" (mouseleave)="showIconView1 = false" /></a> -->
                  <a class="mx-2" (click)="openEditPopup(item, typeInput.value)"><img src="assets/icons/edit.svg"
                      (mouseenter)="showIconEdit1 = true" (mouseleave)="showIconEdit1 = false" /></a>
                  <a class="mx-2" value="Delete" (click)="openDeletePopup(item, i)"><img src="assets/icons/delete.svg"
                      (mouseenter)="showIconDelete1 = true" (mouseleave)="showIconDelete1 = false" /></a>
                </div>
              </td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>

      <tbody *ngIf="typeInput.value != 'All'">
        <ng-container *ngFor="let obj of newMetaData | search: searchText; let i = index">
          <ng-container *ngFor="let item of obj.metadata">
            <tr>
              <td>
                <input type="checkbox" name="foo" class="form-check-input" [(ngModel)]="item.selected" (change)="
                    checkIfAllSelected();
                    deleteMultiRecords(item, i, $event);
                    ViewByCheckbox(item, i, $event);
                    EditByCheckbox(item, i, $event)
                  " id="singleCheck" />
              </td>

              <td>
                <p>{{item.keyId}}</p>
              </td>

              <td>
                <p>{{obj.type}}</p>
              </td>

              <td>
                <p>{{item.value}}</p>
              </td>

              <td>
                <p [style.color]="item.active == 'Y' ? '#00A44C' : item.active == 'N' ? '#fa500f' : ''">
                  {{item.active == 'Y' ? 'Active' : item.active == 'N' ? 'Inactive' : '--'}}
                </p>
              </td>

              <td>
                <p>{{item.remarks ? item.remarks : '--'}}</p>
              </td>

              <td style="position: relative;">
                <a class="pointer" (click)="closeDot($event, i)"><img src="assets/icons/dotlist.svg" width="30" height="12" /></a>
                <div class="plus-img1" id="plus-img{{ i }}" style="display: none">
                  <!-- <div class="lists" *ngIf="showIconView1" style="margin-left: 5px; margin-top: -20px">
                    View
                  </div> -->
                  <div class="lists" *ngIf="showIconEdit1" style="margin-left: 8px; margin-top: -25px">
                    Edit
                  </div>
                  <div class="lists" *ngIf="showIconDelete1" style="margin-left: 28px; margin-top: -25px">
                    Delete
                  </div>

                  <!-- <a class="mx-2" (click)="openViewPopup(item, i)"><img src="assets/icons/view.svg"
                      (mouseenter)="showIconView1 = true" (mouseleave)="showIconView1 = false" /></a> -->
                  <a class="mx-2" (click)="openEditPopup(item, typeInput.value)"><img src="assets/icons/edit.svg"
                      (mouseenter)="showIconEdit1 = true" (mouseleave)="showIconEdit1 = false" /></a>
                  <a class="mx-2" value="Delete" (click)="openDeletePopup(item, i)"><img src="assets/icons/delete.svg"
                      (mouseenter)="showIconDelete1 = true" (mouseleave)="showIconDelete1 = false" /></a>
                </div>
              </td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>

    <div class="d-flex align-items-center justify-content-center" style="height: 50vh;" *ngIf="typeInput.value == 'Create_New'">
      <h1 class="text-secondary">Create New Data</h1>
    </div>
  </div>
</div>
<!-- /table -->

<!-- Loader -->
<div *ngIf="showLoader" class="d-flex justify-content-center align-items-center" style="height: 50vh;">
  <app-loader></app-loader>
</div>
<!-- /Loader -->

<!-- view popup -->
<ng-template #viewDataDialog>
  <div *ngIf="currentItem">
    <div>
      <mat-list>
        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Key Id: </span>{{ currentItem.keyId }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Type: </span>{{ currentItem.type }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Value: </span>{{ currentItem?.value }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <!-- <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Status: </span>{{ currentItem?.status }}
        </mat-list-item>
        <mat-divider></mat-divider> -->

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Remarks: </span>{{ currentItem?.remarks }}
        </mat-list-item>
      </mat-list>
    </div>
    <div mat-dialog-actions>
      <button mat-stroked-button style="color: #D34124; border: 1px solid #D34124; padding: 0;" mat-dialog-close>Close</button>
    </div>
  </div>
</ng-template>
<!-- view popup -->

<!-- edit popup -->
<ng-template #editDataDialog>
  <div>
    <p style="font-weight: 600; color: #ABABAB;">MODIFY DATA</p>
  </div>

  <div class="row" *ngIf="currentItem">
    <div class="col-lg-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Type</mat-label>
        <input matInput [(ngModel)]="currentItem.type" disabled>
      </mat-form-field>
    </div>

    <div class="col-lg-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Id</mat-label>
        <input matInput [(ngModel)]="currentItem.keyId" disabled>
      </mat-form-field>
    </div>

    <div class="col-lg-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Value</mat-label>
        <input matInput [(ngModel)]="currentItem.value">
      </mat-form-field>
    </div>

    <!-- <div class="col-lg-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Status</mat-label>
        <input matInput [(ngModel)]="currentItem.status">
      </mat-form-field>
    </div> -->

    <div class="col-lg-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Remarks</mat-label>
        <input matInput [(ngModel)]="currentItem.remarks">
      </mat-form-field>
    </div>

    <!-- <div class="col-lg-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Model Id</mat-label>
        <mat-select [(ngModel)]="currentItem.productModelId">
          <mat-option [value]="2">2</mat-option>
          <mat-option [value]="13">13</mat-option>
        </mat-select>
      </mat-form-field>
    </div> -->
  </div>

  <div class="d-flex align-items-center justify-content-end">
    <div mat-dialog-actions class="me-2">
      <button mat-stroked-button style="color: #D34124; border: 1px solid #D34124; padding: 0;" mat-dialog-close>Close</button>
    </div>
    <div mat-dialog-actions>
      <button mat-stroked-button style="color: #084982; border: 1px solid #084982; padding: 0;" mat-dialog-close (click)="confirmEditRow()">Update</button>
    </div>
  </div>
</ng-template>
<!-- edit popup -->


<!-- Delete Popup -->
<ng-template #deleteDataDialog>
  <div class="d-flex justify-content-between">
    <p>Delete Row</p>
  </div>
  <div class="text-center">Do you want to delete this item?</div>

  <div class="d-flex align-items-center justify-content-end">
    <div mat-dialog-actions class="me-2">
      <button mat-stroked-button style="color: #D34124; border: 1px solid #D34124; padding: 0;" mat-dialog-close>Close</button>
    </div>
    <div mat-dialog-actions>
      <button mat-stroked-button style="color: #084982; border: 1px solid #084982; padding: 0;" mat-dialog-close (click)="confirmDeleteRow()">OK</button>
    </div>
  </div>
</ng-template>
<!-- /Delete Popup -->



<div style="position: fixed; top: 70px; right: 0; z-index: 99; width: 100%;" *ngIf="showTicket">
  <app-add-metadata [metadataDetail]="newMetaData" (newItemEvent)="closenow($event, 'ticket')"></app-add-metadata>
</div>
