<div class="container-fluid users" id="top">

  <!-- header -->
  <div class="d-flex align-items-center justify-content-between">
    <div class="users-header">
      <p>List of Assets - <span>{{ assetTable.length }}</span></p>
    </div>

    <div>
      <a class="pointer">
        <img src="assets/icons/sites-img.svg" alt=""
          style="border-radius: 24px; box-shadow: 7px 7px 7px 0px #f3f3f3">
      </a>
    </div>
  </div>
  <!-- /header -->

  <!-- status -->
  <div class="row">
    <div class="col-lg-1 col-md-1 d-flex justify-content-start">
      <div class="vl-green"></div>
      <div class="mx-2">
        <div class="status">Added</div>
        <div class="count">{{ added.length }}</div>
      </div>
    </div>

    <div class="col-lg-1 col-md-1 d-flex justify-content-start">
      <div class="vl-red"></div>
      <div class="mx-2">
        <div class="status">Removed</div>
        <div class="count">{{ removed.length }}</div>
      </div>
    </div>

    <div class="col-lg-1 col-md-1 d-flex justify-content-start">
      <div class="vl-yellow"></div>
      <div class="mx-2">
        <div class="status">Synced</div>
        <div class="count">{{ synced.length }}</div>
      </div>
    </div>

    <div class="col-lg-1 col-md-1 d-flex justify-content-start">
      <div class="vl-yellow"></div>
      <div class="mx-2">
        <div class="status">Pending</div>
        <div class="count">{{ pending.length }}</div>
      </div>
    </div>
  </div>
  <!-- /status -->

  <div class="row mt-2">
    <div class="col-lg-4 col-md-4 col-sm-12">
      <!-- <mat-form-field appearance="outline" class="w-100">
        <mat-label>Site Name</mat-label>
        <mat-select>
          <mat-option *ngFor="let item of assetTable">{{ item.id }}</mat-option>
        </mat-select>
      </mat-form-field> -->
      <mat-form-field appearance="outline" class="w-100">
        <input matInput placeholder="Site Id" [matAutocomplete]="site" (keyup)="searchForSiteInput($event)">
        <mat-autocomplete #site="matAutocomplete">
          <mat-option *ngFor="let item of tableData | search: siteSearch" [value]="item" (click)="searchForSiteOption(item)">
            {{ item }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>

    <!-- <div class="col-lg-4 col-md-4 col-sm-12">
      <mat-form-field appearance="outline" class="w-100">
        <input matInput placeholder="Device Id" [matAutocomplete]="dev" (keyup)="searchForSiteInput($event)">
        <mat-autocomplete #dev="matAutocomplete">
          <mat-option *ngFor="let item of assetTable | search: deviceSearch" [value]="item.deviceId" (click)="deviceForSiteOption(item.deviceId)">
            {{ item.deviceId }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div> -->
  </div>



  <div class="my-class mt-3">
    <mat-accordion class="example-headers-align">
      <mat-expansion-panel *ngFor="let id of siteIdToTable; let i = index">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ id }}
          </mat-panel-title>
          <!-- <mat-panel-description>
            {{item}}
          </mat-panel-description> -->
        </mat-expansion-panel-header>

        <mat-tab-group (focusChange)="getAssetss($event)" (selectedIndex)="-1" class="asset-tab">
          <mat-tab></mat-tab>
          <mat-tab *ngFor="let devId of siteMap[i].adsDevices" [label]="devId.deviceId">
            <div class="d-flex align-items-center justify-content-between">

              <!-- form -->
              <div class="search-form mt-2" *ngIf="newTableData.length !== 0">
                <div class="row">

                  <div class="col-lg-6 col-md-6 col-sm-12 device-mode-search">
                    <!-- <mat-form-field appearance="outline" class="w-100">
                      <mat-label>Device Mode</mat-label>
                      <mat-select>
                        <mat-option *ngFor="let item of deviceMode" (click)="selectMode(item.keyId)" [value]="item.keyId">{{item.value}}</mat-option>
                      </mat-select>
                    </mat-form-field> -->
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput placeholder="Device Mode" [matAutocomplete]="mode" (keyup)="searchForModeInput($event)">
                      <mat-autocomplete #mode="matAutocomplete">
                        <mat-option *ngFor="let item of deviceMode | search: modeSearch" [value]="item.value" (click)="searchForModeOption(item.keyId)">
                          {{ item.value }}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>
                  </div>

                  <div class="col-lg-6 col-md-6 col-sm-12">
                    <mat-form-field class="example-form-field" appearance="outline" class="w-100">
                      <mat-label>Search</mat-label>
                      <input matInput type="text" [(ngModel)]="searchText">
                      <button matSuffix mat-icon-button>
                        <mat-icon>search</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>
                </div>
              </div>
              <!-- /form -->

              <!-- Buttons -->
              <!-- <button mat-stroked-button color="primary" (click)="getAssetss('IVISIND1102DV1')">show assets list</button> -->

              <button mat-stroked-button color="primary" (click)="showAddAsset(devId)">ADD</button>
              <!-- Buttons -->
            </div>

            <div class="d-flex justify-content-end mb-2" *ngIf="newTableData.length !== 0">
              <div class="table-icons">
                <div class="lists" *ngIf="showIconView" style="margin-right: 60px; margin-top: -40px">
                  View
                </div>
                <div class="lists" *ngIf="showIconEdit" style="margin-right: 30px; margin-top: -40px">
                  Edit
                </div>
                <div class="lists" *ngIf="showIconDelete" style="margin-right: -5px; margin-top: -40px">
                  Delete
                </div>

                <a class="mx-2" (click)="viewBySelectedOne()"><img src="assets/icons/view.svg" (mouseenter)="showIconView=true" (mouseleave)="showIconView=false"></a>
                <a class="mx-2" (click)="editBySelectedOne()"><img src="assets/icons/edit.svg" (mouseenter)="showIconEdit=true" (mouseleave)="showIconEdit=false"></a>
                <a class="mx-2" (click)="deleteSelected()"><img src="assets/icons/delete.svg" (mouseenter)="showIconDelete=true" (mouseleave)="showIconDelete=false"></a>
              </div>

            </div>
            <!-- table -->
            <h1 class="text-center m-0">{{ assetMsg }}</h1>
            <h3 class="text-center text-primary pointer mb-2" *ngIf="newTableData.length == 0" (click)="showAddAsset(devId)">Add New Asset</h3>

            <div class="table-resp extra w-100" *ngIf="newTableData.length !== 0">
              <table class="table" id="mytable">
                <thead>
                  <tr class="form1">
                    <th>
                      <input type="checkbox" class="form-check-input" [(ngModel)]="selectedAll" (change)="selectAll()" id="allcheck"
                        style="background-color: #00000000; border-color: #fff; margin-left: 10px;">
                    </th>
                    <th (click)="sort('siteId')">Asset Id</th>
                    <th (click)="sort('customerName')">Name</th>
                    <!-- <th  (click)="sort('siteId')">
                      <div class="d-flex align-items-center">
                        Site details<img class="pointer ms-1" (mouseover)="showDetail()" (mouseout)="hideDetail()" src="assets/icons/info_white.svg">
                      </div>
                      <div class="info" *ngIf="info">Device Id + Device Name</div>
                    </th> -->
                    <!-- <th (click)="sort('siteId')">
                      <div class="d-flex align-items-center">
                        Device details<img class="pointer ms-1" src="assets/icons/info_white.svg" (mouseover)="showDetail()" (mouseout)="hideDetail()">
                        <div class="info" *ngIf="info">Device Id + Device Name</div>
                      </div>
                    </th> -->
                    <th (click)="sort('address')">Device mode</th>
                    <th (click)="sort('address')">Duration</th>
                    <th (click)="sort('address')">Start date</th>
                    <th (click)="sort('address')">End date</th>
                    <th (click)="sort('status')">Status</th>
                    <!-- <th (click)="sort('status')">Add</th> -->
                    <th (click)="sort('status')" class="text-center">Ads details</th>
                    <th (click)="sort('status')" class="text-center">Play</th>
                    <th></th>
                  </tr>
                </thead>

                <tbody>
                  <tr *ngFor="let item of newTableData | search: searchText; let i=index;">
                    <td>
                      <input type="checkbox" class="form-check-input" [(ngModel)]="item.selected" (change)="checkIfAllSelected(); deleteMultiRecords(item, i, $event); ViewByCheckbox(item, i, $event); EditByCheckbox(item, i, $event)" id="singleCheck">
                    </td>

                    <td>
                      <p>{{ item.id }}</p>
                    </td>

                    <td>
                      <p>{{ item.name ? item.name : '--' }}</p>
                    </td>

                    <!-- <td>
                      <p>{{ siteIdList + ' ' + '--'}}</p>
                    </td> -->

                    <!-- <td>
                      <p>{{ item.deviceId + ' ' + '--'}}</p>
                    </td> -->

                    <td>
                      <p *ngIf="item.deviceModeId == 1">BS</p>
                      <p *ngIf="item.deviceModeId == 2">BSR</p>
                      <p *ngIf="item.deviceModeId == 3">ODR</p>
                      <!-- <p>{{item.deviceModeId}}</p> -->
                    </td>

                    <!-- <td>
                        <p>{{ item.mimetype }}</p>
                      </td> -->

                    <td>
                      <p>{{item.duration}}</p>
                    </td>

                    <td>
                      <p>{{item.fromDate ? item.fromDate : currentDateTime}}</p>
                    </td>

                    <td>
                      <p>{{item.toDate ? item.toDate : endDateTime}}</p>
                    </td>

                    <!-- <td>
                      <p>{{item.description}}</p>
                    </td> -->
                    <!-- <td>
                        <button class="bg-white" style="color: #084982">{{ item.address }}</button>
                      </td> -->

                    <td>
                      <p [style.color]="item.status == 1 ? '#F5B400' : item.status == 2 ? '#00A44C' : item.status == 5 ? '#fa500f' : '#00A44C'">

                        <span class="d-flex">
                          <span style="width: 50px;">
                            {{ item.status == 1 ? "Pending": item.status == 2 ? "Added" : item.status == 3 ? '' : item.status == 4 ? "Synced" : item.status == 5 ? "Removed" : '--'}}
                          </span>

                          <a (click)="openEditStatus(item.id)" class="ms-2 pointer">
                            <img src="assets/icons/edit.svg"  width="13">
                          </a>
                        </span>

                        <ng-template #editStatusDialog>
                          <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Edit Status</mat-label>
                            <mat-select [(ngModel)]="statusObj.status">
                              <mat-option [value]="2">Added</mat-option>
                              <mat-option [value]="5">Removed</mat-option>
                            </mat-select>
                          </mat-form-field>
                          <button mat-stroked-button style="color: #084982" (click)="changeAssetStatus()">Submit</button>
                        </ng-template>
                      </p>
                    </td>

                    <!-- <td>
                      <button style="background: transparent; border: none;" (click)="showAddAsset()">
                        <img src="assets/icons/add.svg" alt="" width="30" height="30">
                      </button>
                    </td> -->

                    <td class="text-center">
                      <a class="pointer" (click)="openDialog()">
                        <img style="color: #bdb8b8;" src="assets/icons/live_tv.svg" width="20" height="20" />
                      </a>
                    </td>

                    <td class="text-center">
                      <a class="pointer" [href]="item.url" target="_blank">
                        <img style="color: #bdb8b8;" src="assets/icons/play.svg" width="25" height="25" />
                      </a>
                    </td>

                    <td style="position: relative;">
                      <a class="pointer" (click)="closeDot($event, i)"><img src="assets/icons/dotlist.svg" width="30" height="12" /></a>

                      <div class="plus-img1" id="plus-img{{i}}" style="display: none">
                        <div class="lists" *ngIf="showIconView1" style="margin-left: 5px; margin-top: -20px">
                          View
                        </div>
                        <div class="lists" *ngIf="showIconEdit1" style="margin-left: 38px; margin-top: -20px">
                          Edit
                        </div>
                        <div class="lists" *ngIf="showIconDelete1" style="margin-left: 63px; margin-top: -20px">
                          Delete
                        </div>

                        <a class="mx-2" (click)="openViewPopup(item, i)"><img src="assets/icons/view.svg" (mouseenter)="showIconView1 = true" (mouseleave)="showIconView1 = false" /></a>
                        <a class="mx-2" (click)="openEditPopupp(item, i)"><img src="assets/icons/edit.svg" (mouseenter)="showIconEdit1 = true" (mouseleave)="showIconEdit1 = false" /></a>
                        <a class="mx-2" value="Delete" (click)="openDeletePopup(item, i)"><img src="assets/icons/delete.svg" (mouseenter)="showIconDelete1 = true" (mouseleave)="showIconDelete1 = false" /></a>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>

            </div>
            <!-- table -->
          </mat-tab>
        </mat-tab-group>

          <!-- <app-ad-info [myData]="id.siteId"  #[{{id.siteId}}]></app-ad-info> -->

      </mat-expansion-panel>
    </mat-accordion>
  </div>


</div>

<ng-template #viewAssetDialog>
  <div *ngIf="currentItem">
    <div>
      <mat-list>
        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Asset Id:</span> {{ currentItem.id ? currentItem.id : '--' }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Device mode:</span> {{ currentItem?.deviceModeId == 1 ? 'BS' : currentItem?.deviceModeId == 2 ? 'BSR' : currentItem?.deviceModeId == 3 ? 'ODR' : '--' }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">From Date:</span> {{ currentItem.fromDate ? currentItem.fromDate : '--' }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">To Date:</span> {{ currentItem.toDate ? currentItem.toDate : '--' }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Play Order:</span> {{ currentItem.playOrder ? currentItem.playOrder : '--' }}
        </mat-list-item>
        <mat-divider></mat-divider>

        <mat-list-item>
          <span style="width: 130px; color: #ABABAB;">Status:</span> {{ currentItem.status == 1 ? 'Pending' : currentItem.status == 2 ? 'Added' : currentItem.status == 3 ? 'SentToController' : currentItem.status == 4 ? 'Synced' : currentItem.status == 5 ? 'Removed' : '--' }}
        </mat-list-item>
      </mat-list>
    </div>
    <div mat-dialog-actions>
      <button mat-stroked-button style="color: #D34124 ;" mat-dialog-close>Close</button>
    </div>
  </div>
</ng-template>

<ng-template #editAssetDialog>
  <div >
    <div>
      <h2>Asset Id: {{currentItem.id}}</h2>
    </div>

    <div *ngIf="currentItem">
      <div>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Device mode</mat-label>
          <mat-select name="deviceMode" [(ngModel)]="currentItem.deviceModeId" (selectionChange)="on($event)" disabled>
            <mat-option [value]="currentItem.deviceModeId" selected>
              {{ currentItem.deviceModeId == 1 ? 'BS' : currentItem.deviceModeId == 2 ? 'BSR' : currentItem.deviceModeId == 3 ? 'ODR' : '' }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="from-date">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>From date</mat-label>
          <input name="fromDate" matInput [matDatepicker]="picker1" [(ngModel)]="currentItem.fromDate" (dateChange)="onDateChange($event)">
          <mat-datepicker-toggle matIconSuffix [for]="picker1"></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
        </mat-form-field>
      </div>

      <div class="from-date">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>To date</mat-label>
          <input name="toDate" matInput [matDatepicker]="picker2" [(ngModel)]="currentItem.toDate" (dateChange)="onDateChange($event)">
          <mat-datepicker-toggle matIconSuffix [for]="picker2"></mat-datepicker-toggle>
          <mat-datepicker #picker2></mat-datepicker>
        </mat-form-field>
      </div>

      <div>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Play order</mat-label>
          <input name="playOrder" matInput [(ngModel)]="currentItem.playOrder" (change)="onChange($event)">
        </mat-form-field>
      </div>

      <div>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Status</mat-label>
          <mat-select name="status" [(ngModel)]="currentItem.status" (selectionChange)="on($event)">
            <mat-option [value]="currentItem.status" selected>
              {{ currentItem.status == 1 ? 'Pending' : currentItem.status == 2 ? 'Added' : currentItem.status == 3 ? 'SentToController' : currentItem.status == 4 ? 'Synced' : currentItem.status == 5 ? 'Removed' : '' }}
            </mat-option>
            <mat-option [value]="2">Added</mat-option>
            <mat-option [value]="5">Removed</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="d-flex align-items-center justify-content-end">
      <div mat-dialog-actions class="me-2">
        <button mat-stroked-button style="color: #D34124 ;" mat-dialog-close>Close</button>
      </div>
      <div mat-dialog-actions>
        <button mat-stroked-button style="color: #084982 ;" mat-dialog-close (click)="confirmEditRow()">Update</button>
      </div>
    </div>
  </div>
</ng-template>

<div class="modalitem max-center" [hidden]="deletePopup">
  <div class="card">
    <div class="card-header d-flex justify-content-between">
      <p>Delete Row</p>
      <img src="assets/icons/close_form.svg" width="40" height="40" (click)="closeDeletePopup()" />
    </div>
    <div class="card-body text-center">Do you want to delete this item?</div>
    <div class="card-footer">
      <button type="button" class="btn btn-primary mx-2" (click)="confirmDeleteRow()">
        OK
      </button>
      <button type="button" class="btn btn-danger" (click)="closeDeletePopup()">
        Close
      </button>
    </div>
  </div>
</div>



<div style="position: fixed; top: 70px; right: 0; z-index: 99; width: 100%;" *ngIf="showAsset">
  <app-add-new-asset  (newItemEvent)="closenow($event, 'asset')"></app-add-new-asset>
</div>
