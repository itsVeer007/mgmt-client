<div class="container-fluid">
  <!-- header starts -->
  <div class="d-flex justify-content-between">
    <div class="users-header">
      <p>List of all Users - <span>{{userTableData.length}}</span></p>
    </div>
    <div>
      <button class="create-btn" (click)="show('user')">Create User</button>
    </div>
  </div>
  <!-- header ends -->

  <!-- count starts -->
  <div class="row">
    <div class="col-lg-1 col-md-1 col-sm-1 d-flex justify-content-start">
      <div class="vl-green"></div>
      <div class="mx-2">
        <div class="status">Active</div>
        <div class="count">{{activeUsers.length}}</div>
      </div>
    </div>
    <div class="col-lg-1 col-md-1 col-sm-1 d-flex justify-content-start">
      <div class="vl-red"></div>
      <div class="mx-2">
        <div class="status">Inactive</div>
        <div class="count">{{inactiveUsers.length}}</div>
      </div>
    </div>
    <!-- <div class="col-lg-1 col-md-1 col-sm-1 d-flex justify-content-start">
      <div class="vl-yellow"></div>
      <div class="mx-2">
        <div class="status">Onhold</div>
        <div class="count">0</div>
      </div>
    </div> -->
  </div>

  <!-- form starts -->
  <div class="search-form">
    <!-- <div class="col-lg-10 col-md-10">
      <form class="row p-0">
        <div class="col-lg-4 col-md-4 col-sm-4 select">
          <select class="form-select">
            <option selected>All</option>
            <option></option>
          </select>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4 search">
          <input type="text" placeholder="Search" name="search2" [(ngModel)]="searchText" />
          <button type="submit">
            <a><img src="assets/icons/search.svg" /></a>
          </button>
        </div>
      </form>
    </div> -->
    <div class="row col-md-12 mt-2">
      <!-- <div class="col-lg-3 col-md-3 col-sm-12">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>User Name</mat-label>
          <mat-select>
            <mat-option *ngFor="let cust of userTableData" [value]="cust.firstName">{{ cust.firstName }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div> -->

      <div class="col-lg-3 col-md-3 col-sm-12">
        <mat-form-field class="example-form-field" appearance="outline" class="w-100">
          <mat-label>Search</mat-label>
          <input matInput type="text" [(ngModel)]="searchText">
          <button matSuffix mat-icon-button>
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>
  </div>

  <!-- table starts -->
  <div class="table-resp">
    <table class="table" id="mytable">
      <thead>
        <tr class="form1">
          <!-- <th>
              <input type="checkbox" class="form-check-input" [(ngModel)]="selectedAll" (change)="selectAll()"
              id="allcheck" style="
              background-color: #00000000;
              border-color: #fff;
              margin-left: 10px;
              " />
            </th> -->
          <th>
            <span>ID</span>
            <img (click)="sort('user_id')" class="pointer ms-1" src="assets/icons/sorticon.svg" width="15px">
          </th>
          <th>
            <span>
              Name
            </span>
            <img (click)="sort('firstName')" class="pointer ms-1" src="assets/icons/sorticon.svg" width="15px">
          
          </th>
          <th (click)="sort('')">Assign Site</th>
          <!-- <th (click)="sort('custType')">Role</th> -->
          <th (click)="sort('contactNumber')">Contact Number</th>
          <th (click)="sort('emailId')">Email id</th>
          <th (click)="sort('address')">Address</th>
          <!-- <th (click)="sort('contactPerson')">#Sites</th> -->
          <!-- <th (click)="sort('contactPerson')">Safety Escort</th> -->
          <th (click)="sort('status')">Status</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>

      <tbody *ngIf="!showLoader">
        <tr *ngFor="let cust of userTableData | search : searchText; let i = index">
          <!-- <td>
            <input type="checkbox" name="foo" class="form-check-input" [(ngModel)]="cust.selected" (change)="
            checkIfAllSelected();
            deleteMultiRecords(cust, i, $event);
            ViewByCheckbox(cust, i, $event);
            EditByCheckbox(cust, i, $event)
            " id="singleCheck" />
          </td> -->
          <td>
            <p>{{ cust.user_id }}</p>
          </td>
          <td>
            <p>{{ cust.User_Name }}</p>
          </td>

          <td>
            <p>{{ cust.assignSite }}</p>
            <a class="pointer mx-1.
            " [matMenuTriggerFor]="sitesMenu" (click)="getSitesListforUser(cust)" >
              <!-- matTooltip="Assign Site to the user" -->
              View
            </a>
          </td>
   


          <mat-menu #sitesMenu="matMenu">
            <!-- <p class="px-2 py-1" *ngIf="currentUser != null">{{ currentUser?.address_line1 }}</p> -->
            <P class="text-center">Total No.of Sites:<span> {{userSites.length}}</span></P>
            <div class="d-flex justify-content-center">
              <button class="btn btn-light " (click)="assignSite(cust)" style="border-radius: 10px;">
                Add 
             </button>
            </div>

            <!-- <span class="mx-3"> Add Site <img src="assets/icons/add_circle.svg" (click)="assignSite(cust)"></span> -->
            <div *ngFor="let site of userSites let i = index" class="p-2 mx-2" style="font-size: 12px;">
              <span class="mx-3"> ({{i+1}}) <span>{{site.siteName}}</span></span>
            </div> 

          </mat-menu>

          <!-- <td>
            <p>{{ cust.roleList }}</p>
          </td> -->
          <td>
            <p>{{ cust.contactNo1 }}</p>
          </td>
          <td>
            <p>{{ cust.email }}</p>
          </td>
          <td>
            <p class="text-primary pointer" [matMenuTriggerFor]="userAddress" (click)="getUserInfoForUserId(cust)">View</p>
            <mat-menu #userAddress="matMenu">
              <p class="px-2 py-1" *ngIf="currentUser != null">{{ currentUser?.address_line1 }}</p>
              <p class="px-2 py-1" *ngIf="currentUser != null">
                {{ currentUser?.city }}, {{ currentUser?.district }}, {{ currentUser?.state }}, {{ currentUser?.country }}, {{ currentUser?.pin }}
              </p>
              <p class="px-2 py-1" *ngIf="currentUser == null">No Data</p>
            </mat-menu>
          </td>
          <!-- <td>
            <a class="pointer" (click)="show('additionalSite')">
              <img src="assets/icons/add.svg" width="40">
            </a>
          </td> -->
          <!-- <td>
            <p>{{ cust.safetyEscort }}</p>
          </td> -->
          <td>
            <p
              [style.color]="cust.status == 'T' ? '#00A44C' : cust.status == 'Onhold' ? '#F5B400' : cust.status == 'F' ? '#fa500f' : ''">
              {{ cust.status == 'T' ? 'Active' : cust.status == 'F' ? 'Inactive' : 'Inactive' }}
            </p>
          </td>

          <td class="text-center">
            <a class="pointer mx-1" matTooltip="View" (click)="openViewProfileDialog(cust)">
              <img src="assets/icons/view.svg">
            </a>
            <a class="pointer mx-1" matTooltip="Edit" (click)="openEditProfileDialog(cust)">
              <img src="assets/icons/edit.svg">
            </a>
            <!-- <a class="pointer mx-1" value="Delete" matTooltip="Delete">
              <img src="assets/icons/delete.svg">
            </a> -->
          </td>



        </tr>
      </tbody>
    </table>
    <!-- error info -->
    <div class="err-info" style="height: 45vh;" *ngIf="userTableData.length == 0 && !showLoader">
      <h1 class="text-secondary">No Devices</h1>
    </div>
  
    <!-- loader -->
    <div *ngIf="showLoader" class="d-flex justify-content-center align-items-center" style="height: 45vh;">
      <app-loader></app-loader>
    </div>
  </div>

</div>

<ng-template #viewprofileDialog>
  <div style="background-color: #084982;">
    <p class="text-white p-1">VIEW PROFILE</p>
  </div>
  <div class="dialog-content" *ngIf="currentUser">
    <div class="row m-0">
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>First Name</mat-label>
          <input matInput [(ngModel)]="currentUser.firstName" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Last Name</mat-label>
          <input matInput [(ngModel)]="currentUser.LastName" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Email</mat-label>
          <input matInput [(ngModel)]="currentUser.email" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>ContactNo 1</mat-label>
          <input matInput [(ngModel)]="currentUser.contactNo1" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>ContactNo 2</mat-label>
          <input matInput [(ngModel)]="currentUser.contactNo2" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Address_line 1</mat-label>
          <input matInput [(ngModel)]="currentUser.address_line1" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Address_line 2</mat-label>
          <input matInput [(ngModel)]="currentUser.address_line2" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>City</mat-label>
          <input matInput [(ngModel)]="currentUser.city" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Pin</mat-label>
          <input matInput [(ngModel)]="currentUser.pin" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>State</mat-label>
          <input matInput [(ngModel)]="currentUser.state" disabled>
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Country</mat-label>
          <input matInput [(ngModel)]="currentUser.country" disabled>
        </mat-form-field>
      </div>
    </div>
  </div>

  <div class="d-flex align-items-center justify-content-end mt-2">
    <button class="dialog-close-btn" mat-dialog-close>Close</button>
    <button class="dialog-submit-btn" mat-dialog-close (click)="updateUser()">Update</button>
  </div>
</ng-template>

<ng-template #editprofileDialog>
  <div style="background-color: #084982;">
    <p class="text-white p-1">EDIT PROFILE</p>
  </div>
  <div class="dialog-content" *ngIf="currentUser">

    <div class="row m-0">
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>First Name</mat-label>
          <input matInput [(ngModel)]="currentUser.firstName">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Last Name</mat-label>
          <input matInput [(ngModel)]="currentUser.LastName">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>profileImage</mat-label>
          <input matInput [(ngModel)]="currentUser.profileImage">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Address_line 1</mat-label>
          <input matInput [(ngModel)]="currentUser.address_line1">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Address_line 2</mat-label>
          <input matInput [(ngModel)]="currentUser.address_line2">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>ContactNo 1</mat-label>
          <input matInput [(ngModel)]="currentUser.contactNo1">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>ContactNo 2</mat-label>
          <input matInput [(ngModel)]="currentUser.contactNo2">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>City</mat-label>
          <input matInput [(ngModel)]="currentUser.city">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Pin</mat-label>
          <input matInput [(ngModel)]="currentUser.pin">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>district</mat-label>
          <input matInput [(ngModel)]="currentUser.district">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>State</mat-label>
          <input matInput [(ngModel)]="currentUser.state">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Country</mat-label>
          <input matInput [(ngModel)]="currentUser.country">
        </mat-form-field>
      </div>


      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>gender</mat-label>
          <input matInput [(ngModel)]="currentUser.gender">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>active</mat-label>
          <input matInput [(ngModel)]="currentUser.active">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>employee</mat-label>
          <input matInput [(ngModel)]="currentUser.employee">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>empId</mat-label>
          <input matInput [(ngModel)]="currentUser.empId">
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>safetyEscort</mat-label>
          <input matInput [(ngModel)]="currentUser.safetyEscort">
        </mat-form-field>
      </div>



      
    </div>
  </div>

  <div class="d-flex align-items-center justify-content-end mt-2">
    <button class="dialog-close-btn" mat-dialog-close>Close</button>
    <button class="dialog-submit-btn" mat-dialog-close (click)="updateUser()">Update</button>
  </div>
</ng-template>

<ng-template #assignSiteDialog>
  <div style="background-color: #084982;">
    <p class="text-white p-1">Assign Site</p>
  </div>

  <div class="dialog-content">
    <!-- <div class="w-100">
      <app-filter [filterType]="'users'" (tableDataFromChild)="getSites($event)"></app-filter>
    </div> -->

    <div>
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Select site</mat-label>
        <input matInput #siteIdInput [matAutocomplete]="site" [(ngModel)]="selectedSites" >
        <button matSuffix mat-icon-button>
          <mat-icon>arrow_drop_down</mat-icon>
        </button>
        <mat-autocomplete #site="matAutocomplete">
          <mat-option *ngFor="let item of sitesList | search: searchText" [value]="item.siteId">
            {{ item.siteId }} - {{ item.siteName }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>
    

    <div class="d-flex align-items-center justify-content-end mt-2">
      <button class="dialog-close-btn" mat-dialog-close>Close</button>
      <button class="dialog-submit-btn" mat-dialog-close (click)="submitAssignSite()">Submit</button>
    </div>
  </div>
</ng-template>


<div *ngIf="showAddUser">
  <app-add-new-user (newItemEvent)="closenow('user'); listUsers()"></app-add-new-user>
</div>

<div *ngIf="showAddSite">
  <app-add-additional-site (newItemEvent)="closenow('additionalSite')"></app-add-additional-site>
</div>